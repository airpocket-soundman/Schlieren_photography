# Spresense BOS カメラシステム  
Sony Spresense / 拡張ボード / HDR カメラボード を使用した  
**BOS（背景シュリーレン：Background Oriented Schlieren）可視化カメラ**

---

## 📌 概要

このプロジェクトは Sony **Spresense** を用いて、  
「空気のゆらぎ」「熱による屈折」「圧力の変化」などを  
**BOS（背景シュリーレン法）**でリアルタイムに可視化するためのカメラシステムです。

本システムでは次の動作を行います：

1. **起動時に 960×720 の標準背景画像を撮影して SD 保存**  
2. **ストリーミング映像（320×240）を ILI9341 に表示してモニタモードに移行**  
3. シリアル入力で **BOS 用画像（960×720）を撮影**  
4. **BOS 解析（差分可視化）を実行し SD 保存**  
5. **解析結果を 320×240 に縮小してディスプレイに表示**  
6. シリアル入力で **再びモニタモードへ戻る**

JPEG は使用せず、**BMP（RGB565）で高速保存**しています。

---

## 🧰 必要ハードウェア

| 部品 | 説明 |
|------|------|
| Spresense メインボード | 必須 |
| Spresense 拡張ボード | カメラ接続・SD 使用のため |
| HDR カメラボード | 静止画のみ HDR 可 |
| ILI9341 TFT LCD | SPI4 接続 |
| microSD カード | FAT32 |

---

## 📁 ソフトウェア構成

- Arduino Spresense SDK  
- LovyanGFX  
- Camera ライブラリ  
- SDHCI ライブラリ  
- Arduino IDE または PlatformIO  

---

## 🎬 動作フロー

[起動] → (1) 背景画像保存 → (2) モニター表示  
→ シリアル入力 → (3) BOS撮影 → (4) 解析 → (5) 表示  
→ シリアル入力 → (2) に戻る

---

## 🔍 BOS 解析方法（簡易版）

1. 背景画像と現在画像を RGB565 として取得  
2. 輝度に変換し差分を計算  
3. 差分強調して可視化  
4. RGB565 の BMP として保存  

---

## 💾 SD に保存されるファイル

- `background.bmp` — 標準背景画像  
- `bos_result.bmp` — BOS 解析結果  

---

## 🖥 表示

- ライブモニタ：320×240  
- BOS結果：320×240（縮小表示）  

---

## 📡 シリアル操作

| 入力 | 動作 |
|------|------|
| 任意のキー入力 | BOS 撮影＆解析 |
| 結果表示中にキー入力 | モニター再開 |

---

## 📁 ディレクトリ構成例

BOS_Camera/  
├── BOS_Camera.ino  
├── LGFX_SPRESENSE_ILI9341.hpp  
├── README_jp.md  
└── /sd/  

---

## 🔧 ILI9341 配線（SPI4）

- MOSI: SPI4  
- MISO: SPI4  
- SCK : SPI4  
- DC  : D9  
- CS  : D10  
- RST : D8  

---

## 🧪 注意点

- HDR は静止画のみ対応（ストリーム不可）  
- BOS は簡易差分アルゴリズム  
- SD 書き込み速度に依存  

---

## 🔮 今後の拡張案

- カラーマップ表示  
- Sobel / Laplacian 解析  
- Optical Flow によるベクトル BOS  

---

## 📜 ライセンス

MIT License
